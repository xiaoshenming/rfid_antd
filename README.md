# 饭卡充值消费系统

---

> **一站式智能饭卡管理平台，融合RFID技术与现代Web前端，助力校园一卡通数字化升级！**

---

## 项目简介

本项目是基于Vue 3与Ant Design Vue开发的饭卡充值消费系统，结合RFID硬件与串口通信，实现了饭卡的注册、充值、消费、挂失、注销等全流程管理。系统界面美观、交互友好，适用于高校、企业等场景下的智能一卡通管理。

---

## 目录结构

```
rfid_antd/
├── public/                # 公共资源
├── src/
│   ├── assets/            # 静态资源
│   ├── components/        # 主要功能组件
│   │   ├── Dashboard.vue      # 系统功能总览
│   │   ├── LoginView.vue      # 登录界面
│   │   ├── MainView.vue       # 主操作界面
│   │   ├── SerialMonitor.vue  # 串口通信监控
│   │   ├── HelloWorld.vue     # 示例组件
│   │   └── card/              # 卡片相关子组件
│   ├── utils/             # 工具函数
│   │   ├── cardDataUtils.js       # 卡数据解析与构造
│   │   └── serialCommunication.js # 串口通信核心逻辑
│   ├── App.vue            # 应用入口
│   ├── main.js            # 启动脚本
│   └── style.css          # 全局样式
├── README.md              # 项目说明文档
├── package.json           # 依赖与脚本
├── vite.config.js         # Vite配置
└── ...
```

---

## 核心功能模块

- **用户登录**：账号密码校验，安全进入系统主界面。
- **饭卡注册**：为新用户分配饭卡，初始化余额与学号。
- **充值与消费**：支持余额充值与消费扣款，实时同步卡片数据。
- **挂失与注销**：一键挂失丢失卡片，注销不再使用的饭卡。
- **串口通信监控**：实时查看串口数据收发日志，便于调试与维护。
- **操作记录**：完整记录所有操作，便于追溯与统计。

---

## 技术实现方案

### 前端技术栈
- **Vue 3**：响应式组件化开发，提升开发效率与可维护性。
- **Ant Design Vue**：高颜值UI组件库，保证界面美观与交互一致性。
- **Vite**：极速开发与构建工具，提升开发体验。
- **Web Serial API**：实现浏览器与RFID硬件的串口通信。

### 主要技术原理

#### 1. 串口通信协议
- 串口参数：USART1，波特率可选（如9600/115200），8数据位，1停止位，无校验，无流控，\n为结束标志。
- 命令格式：上位机发送以\n结尾的ASCII命令，支持RID（读卡ID）、RBK（读数据块）、WBK+数据（写数据块）等。
- 数据结构：写入命令采用32位十六进制字符串，包含卡状态、挂失状态、金额、学号等信息，剩余部分以FF填充。
- 错误处理：未知命令或格式错误均有明确响应，保证通信健壮性。

#### 2. 卡片数据解析与构造
- `cardDataUtils.js`模块负责将32位十六进制字符串解析为结构化对象，并支持反向构造，确保数据一致性与安全性。

#### 3. 串口通信核心
- `serialCommunication.js`模块基于Web Serial API，封装串口打开、关闭、数据收发、事件监听等功能，支持多种串口参数配置。
- 支持实时日志记录与自动滚动，便于开发调试。

#### 4. 组件化设计
- 各功能模块均以Vue组件形式实现，便于扩展与维护。
- 串口监控、卡片操作、用户登录等均为独立组件，职责清晰。

---

## 特色与亮点

- **极致美观UI**：Ant Design Vue深度定制，界面简洁大气，交互流畅。
- **高扩展性**：组件化架构，便于功能拓展与二次开发。
- **硬件直连**：Web Serial API实现浏览器直连RFID设备，无需中间服务。
- **安全可靠**：严格的数据校验与错误处理，保障系统稳定运行。
- **详细日志**：串口通信全程可追溯，便于问题定位。

---

## 快速上手

1. 安装依赖：
   ```bash
   npm install
   ```
2. 启动开发环境：
   ```bash
   npm run dev
   ```
3. 访问本地：http://localhost:5173/

---

## 串口通信协议（硬件对接参考）

详见下方原始协议说明：

> 串口号：USART1
> 波特率：请根据实际设置补充（如 9600、115200 等）
> 数据位：8
> 停止位：1
> 校验位：无
> 流控：无
> 接收结束标志：\n（换行符）

- 上位机通过串口发送以“\n”结尾的ASCII命令字符串
- 单条指令最大长度：不超过 RX_BUFFER_SIZE 字节
- 所有命令均为大写英文字母+参数 的格式

**支持命令一览：**
| 指令代码 | 含义     | 参数                  | 响应说明                 |
|----------|----------|-----------------------|--------------------------|
| RID\n    | 读取卡ID | 无                    | 读取并上传卡ID           |
| RBK\n    | 读取数据块 | 无                    | 读取块1的数据并上传       |
| WBK+数据\n | 写入数据块 | 32位ASCII十六进制字符串 | 返回“写入完成”或“命令格式错误” |

**命令格式说明：**
- RID\n：读取当前检测到的RFID卡片ID，响应上传卡ID（HEX字符串或原始字节序列）
- RBK\n：读取第1块内容，响应上传16字节数据
- WBK+数据\n：写入卡片数据，数据结构如下：
  - 第1位：卡状态（1=已注册，0=未注册）
  - 第2位：挂失状态（0=未挂失，1=挂失）
  - 第3-6位：金额（4位十六进制，最大9999）
  - 第7-18位：学号（12位数字）
  - 剩余部分填充FF至32位

- 成功响应：写入完成\r\n
- 格式错误响应：写入命令格式错误\r\n
- 未知命令：返回未知命令\r\n
---

## 联系与支持

如需定制开发、技术支持或有任何建议，欢迎联系项目维护者。

---

> **让饭卡管理更智能，让校园生活更便捷！**
